variables:
  NODE_VERSION: node:16.14-alpine

image: $NODE_VERSION

default:
  tags:
    - gitlab-runner-ec2

stages:
  - build
  - test
  - e2e

# ui-components-admin jobs
# ui-components-admin build:
#   stage: build
#   script:
#     - yarn install && yarn nx build ui-components-admin

# ui-components-admin test:
#   stage: test
#   script:
#     - yarn install && yarn nx test ui-components-admin

ui-components-admin e2e:
  stage: e2e
  image: cypress/browsers:node18.12.0-chrome107
  script:
    - yarn global add serve
    - yarn global add wait-on
    - serve -s build &
    - wait-on http://localhost:5173
    - yarn install && yarn nx component-test ui-components-admin --browser chrome --headless --reporter junit
  artifacts:
    when: always
    paths:
      - test-results.xml
    reports:
      junit: test-results.xml

# admin jobs
# admin build:
#   stage: build
#   needs: ["ui-components-admin build"]
#   script:
#     - yarn install && yarn nx build admin

# admin test:
#   stage: test
#   script:
#     - yarn install && yarn nx test admin

# voting jobs
# voting build:
#   stage: build
#   needs: ["ui-components-admin build"]
#   script:
#     - yarn install && yarn nx build voting

# voting test:
#   stage: test
#   script:
#     - yarn install && yarn nx test voting

  environment: production
