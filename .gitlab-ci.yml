variables:
  NODE_VERSION: node:16.14-alpine

image: $NODE_VERSION

default:
  tags:
    - gitlab-runner-ec2

stages:
  - build
  - test
  - e2e

# ui-components-admin jobs
# ui-components-admin build:
#   stage: build
#   script:
#     - yarn install && yarn nx build ui-components-admin

# ui-components-admin test:
#   stage: test
#   script:
#     - yarn install && yarn nx test ui-components-admin

ui-components-admin:
  stage: e2e
  image: cypress/browsers:node18.12.0-chrome107
  script:
    - apt-get update && apt-get install -y xvfb
    - Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &
    - export DISPLAY=:99
    - yarn install && yarn nx component-test ui-components-admin --exit

# admin jobs
# admin build:
#   stage: build
#   needs: ["ui-components-admin build"]
#   script:
#     - yarn install && yarn nx build admin

# admin test:
#   stage: test
#   script:
#     - yarn install && yarn nx test admin

# voting jobs
# voting build:
#   stage: build
#   needs: ["ui-components-admin build"]
#   script:
#     - yarn install && yarn nx build voting

# voting test:
#   stage: test
#   script:
#     - yarn install && yarn nx test voting

  environment: production
