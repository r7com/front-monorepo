variables:
  NODE_VERSION: node:16.14-alpine

image: $NODE_VERSION

default:
  tags:
    - gitlab-runner-ec2

stages:
  - build
  - test
  - e2e

# ui-components-admin jobs
ui-components-admin build:
  stage: build
  script:
    - yarn install && yarn nx build ui-components-admin

ui-components-admin test:
  stage: test
  script:
    - yarn install && yarn nx test ui-components-admin

# admin jobs
admin build:
  stage: build
  needs: ["ui-components-admin build"]
  script:
    - yarn install && yarn nx build admin

admin test:
  stage: test
  script:
    - yarn install && yarn nx test admin

admin-e2e e2e:
  stage: e2e
  script:
    - yarn install && yarn nx e2e admin-e2e

# voting jobs
voting build:
  stage: build
  needs: ["ui-components-admin build"]
  script:
    - yarn install && yarn nx build voting

voting test:
  stage: test
  script:
    - yarn install && yarn nx test voting

voting-e2e e2e:
  stage: e2e
  script:
    - yarn install && yarn nx e2e voting-e2e

  environment: production
